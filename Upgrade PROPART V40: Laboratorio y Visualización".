
async function vincularUniversal() {
    const status = document.getElementById('status');
    // Lista de llaves (UUIDs) para probar
    const uuids = [
        '00001101-0000-1000-8000-00805f9b34fb', // Estándar Serial
        '0000fff0-0000-1000-8000-00805f9b34fb'  // BLE Alternativo
    ];

    try {
        status.innerText = "BUSCANDO ESCÁNER...";
        status.style.color = "yellow";

        const device = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: uuids // Aquí le decimos que busque cualquiera de las dos
        });

        status.innerText = "CONECTANDO A: " + device.name;
        const gattServer = await device.gatt.connect();
        
        // Intentamos conectar al primer servicio disponible
        let service;
        try {
            service = await gattServer.getPrimaryService(uuids[0]);
        } catch(e) {
            service = await gattServer.getPrimaryService(uuids[1]);
        }
        
        // Buscamos la característica de escritura/lectura
        const characteristics = await service.getCharacteristics();
        bluetoothCharacteristic = characteristics[0]; // Agarramos la primera que sirva para hablar

        status.innerText = "✅ CONEXIÓN TOTAL: " + device.name;
        status.style.color = "var(--green)";
        document.getElementById('controles').style.display = "block";

    } catch (error) {
        status.innerText = "❌ ERROR DE LLAVE: " + error.message;
        status.style.color = "var(--red)";
    }
}
